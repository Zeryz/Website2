<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pool Tournament Manager</title>
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/style.css?v=100">
    <style>
        body { background:#000; color:#fff; font-family:system-ui,-apple-system,sans-serif; min-height:100vh; padding:2rem; }
        header nav { text-align:center; margin-bottom:2rem; }
        header a { color:#00f5ff; text-decoration:none; font-size:1.2rem; }
        .hero { text-align:center; margin-bottom:3rem; }
        .hero h1 { font-size:clamp(3rem,10vw,6rem); background:linear-gradient(90deg,#00f5ff,#80f8ff); -webkit-background-clip:text; background-clip:text; -webkit-text-fill-color:transparent; }
        .hero p { font-size:1.5rem; opacity:0.9; }
        .photo { width:140px; height:140px; border-radius:50%; border:5px solid #00f5ff; box-shadow:0 0 40px #00f5ff60; }
        .calc-container { background:#111; padding:3rem; border-radius:20px; border:4px solid #00f5ff; box-shadow:0 0 50px #00f5ff60; max-width:800px; margin:0 auto; }
        .inputs { display:grid; gap:1.5rem; margin-bottom:2rem; }
        label { display:block; margin-bottom:0.5rem; color:#00f5ff; font-weight:bold; }
        textarea { width:100%; padding:1rem; background:#000; border:2px solid #00f5ff; border-radius:8px; color:#fff; font-size:1rem; height:250px; }
        button { width:100%; padding:1.2rem; background:#00f5ff; color:#000; border:none; border-radius:12px; font-size:1.4rem; font-weight:bold; cursor:pointer; margin-top:1rem; }
        button:hover { background:#80f8ff; }
        .result { margin-top:2rem; padding:1.5rem; background:#000; border-radius:12px; border:1px solid #00f5ff40; font-size:1.6rem; line-height:2; text-align:center; }
        .round-title { font-size:2rem; margin-bottom:1.5rem; color:#00f5ff; text-shadow:0 0 20px #00f5ff80; }
        .pairing { margin:0.8rem 0; font-size:1.5rem; }
        footer { text-align:center; margin-top:4rem; opacity:0.7; font-size:0.9rem; }
    </style>
</head>
<body>
    <header>
        <nav><a href="index.html">← Home</a></nav>
    </header>

    <main>
        <section class="hero">
            <h1>Pool Tournament Manager</h1>
            <p>Random pairings — no repeats, fair byes</p>
            <img src="images/photo.jpg" alt="Jesse" class="photo">
        </section>

        <div class="calc-container">
            <div class="inputs">
                <div>
                    <label>Player Names (one per line)</label>
                    <textarea id="players" placeholder="Jesse\nAlex\nSam\nTaylor\nChris\nMorgan\nRiley\nJordan"></textarea>
                </div>
            </div>

            <button onclick="generateNextRound()">Generate Next Round</button>
            <button onclick="resetTournament()" style="margin-top:1rem; background:#333;">Reset Tournament</button>

            <div class="result" id="result">
                Enter player names and click Generate Next Round
            </div>
        </div>
    </main>

    <footer>
        <p>© 2025 Jesse · -What a headache this crap is-</p>
    </footer>

    <script>
        let players = [];
        let history = []; // past pairings as "Player1-Player2" (sorted)
        let byeCount = {}; // player: number of byes

        function generateNextRound() {
            const text = document.getElementById('players').value.trim();
            if (!text) {
                document.getElementById('result').innerHTML = "Enter player names first.";
                return;
            }

            players = text.split('\n').map(p => p.trim()).filter(p => p);
            if (players.length < 2) {
                document.getElementById('result').innerHTML = "Need at least 2 players.";
                return;
            }

            let pairings = [];
            let used = new Set();
            let shuffled = [...players];
            let attempts = 0;

            // Try to find valid pairing without repeats or multiple byes
            while (attempts < 200) {
                pairings = [];
                used = new Set();
                shuffled = [...players];
                shuffle(shuffled);

                let valid = true;
                for (let i = 0; i < shuffled.length; i += 2) {
                    if (i + 1 >= shuffled.length) {
                        // Bye
                        const p = shuffled[i];
                        if ((byeCount[p] || 0) >= 1) {
                            valid = false;
                            break;
                        }
                        pairings.push(`${p} — BYE`);
                        byeCount[p] = (byeCount[p] || 0) + 1;
                        used.add(p);
                        break;
                    }

                    let p1 = shuffled[i];
                    let p2 = shuffled[i + 1];
                    let pairKey = [p1, p2].sort().join('-');

                    if (history.includes(pairKey)) {
                        valid = false;
                        break;
                    }

                    pairings.push(`${p1} vs ${p2}`);
                    history.push(pairKey);
                    used.add(p1);
                    used.add(p2);
                }

                if (valid) break;
                attempts++;
            }

            if (attempts >= 200) {
                document.getElementById('result').innerHTML = "Couldn't find valid pairings — try Reset Tournament.";
                return;
            }

            const roundNum = Math.ceil(history.length / Math.floor(players.length / 2));
            let html = `<div class="round-title">Round ${roundNum}</div>`;
            pairings.forEach(p => html += `<div class="pairing">${p}</div>`);

            document.getElementById('result').innerHTML = html;
        }

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function resetTournament() {
            history = [];
            byeCount = {};
            document.getElementById('result').innerHTML = "Tournament reset — ready for new pairings!";
        }
    </script>
</body>
</html>
