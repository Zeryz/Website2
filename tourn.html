<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pool Night Pairings</title>
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/style.css?v=100">
    <style>
        body { background:#000; color:#fff; font-family:system-ui,-apple-system,sans-serif; min-height:100vh; padding:2rem; }
        header nav { text-align:center; margin-bottom:2rem; }
        header a { color:#00f5ff; text-decoration:none; font-size:1.2rem; }
        .hero { text-align:center; margin-bottom:3rem; }
        .hero h1 { font-size:clamp(3rem,10vw,6rem); background:linear-gradient(90deg,#00f5ff,#80f8ff); -webkit-background-clip:text; background-clip:text; -webkit-text-fill-color:transparent; }
        .hero p { font-size:1.5rem; opacity:0.9; }
        .photo { width:140px; height:140px; border-radius:50%; border:5px solid #00f5ff; box-shadow:0 0 40px #00f5ff60; }
        .calc-container { background:#111; padding:3rem; border-radius:20px; border:4px solid #00f5ff; box-shadow:0 0 50px #00f5ff60; max-width:800px; margin:0 auto; }
        .inputs { display:grid; gap:1.5rem; margin-bottom:2rem; }
        label { display:block; margin-bottom:0.5rem; color:#00f5ff; font-weight:bold; }
        textarea { width:100%; padding:1rem; background:#000; border:2px solid #00f5ff; border-radius:8px; color:#fff; font-size:1rem; height:250px; }
        button { width:100%; padding:1.2rem; background:#00f5ff; color:#000; border:none; border-radius:12px; font-size:1.4rem; font-weight:bold; cursor:pointer; margin-top:1rem; }
        button:hover { background:#80f8ff; }
        .result { margin-top:2rem; padding:1.5rem; background:#000; border-radius:12px; border:1px solid #00f5ff40; font-size:1.6rem; line-height:2; text-align:center; }
        footer { text-align:center; margin-top:4rem; opacity:0.7; font-size:0.9rem; }
    </style>
</head>
<body>
    <header>
        <nav><a href="index.html">← Home</a></nav>
    </header>

    <main>
        <section class="hero">
            <h1>Pool Night Pairings</h1>
            <p>Random matches — no repeats, fair byes</p>
            <img src="images/photo.jpg" alt="Jesse" class="photo">
        </section>

        <div class="calc-container">
            <div class="inputs">
                <div>
                    <label>Player Names (one per line)</label>
                    <textarea id="players" placeholder="Jesse\nAlex\nSam\nTaylor\nChris\nMorgan\nRiley\nJordan"></textarea>
                </div>
            </div>

            <button onclick="generateRound()">Generate Next Round</button>
            <button onclick="resetHistory()" style="margin-top:1rem; background:#333;">Reset History (New Night)</button>

            <div class="result" id="result">
                Enter player names and click Generate Next Round
            </div>
        </div>
    </main>

    <footer>
        <p>© 2025 Jesse · -What a headache this crap is-</p>
    </footer>

    <script>
        let history = []; // all past match pairs
        let byeHistory = {}; // player: bye count

        function generateRound() {
            const text = document.getElementById('players').value.trim();
            if (!text) {
                document.getElementById('result').innerHTML = "Enter player names first.";
                return;
            }

            let players = text.split('\n').map(p => p.trim()).filter(p => p);
            if (players.length < 2) {
                document.getElementById('result').innerHTML = "Need at least 2 players.";
                return;
            }

            let pairings = [];
            let used = new Set();
            let shuffled = [...players];
            shuffle(shuffled);

            // Try to pair without repeats or multiple byes
            let attempts = 0;
            while (attempts < 100) { // prevent infinite loop
                pairings = [];
                used = new Set();
                let current = [...shuffled];
                shuffle(current);

                let valid = true;
                for (let i = 0; i < current.length; i += 2) {
                    if (i + 1 >= current.length) {
                        // bye
                        const p = current[i];
                        if ((byeHistory[p] || 0) >= 1) {
                            valid = false;
                            break;
                        }
                        pairings.push(`${p} has a bye`);
                        used.add(p);
                        byeHistory[p] = (byeHistory[p] || 0) + 1;
                        break;
                    }

                    let p1 = current[i];
                    let p2 = current[i + 1];
                    let pairKey = [p1, p2].sort().join('-');

                    if (history.includes(pairKey)) {
                        valid = false;
                        break;
                    }

                    pairings.push(`${p1} vs ${p2}`);
                    history.push(pairKey);
                    used.add(p1);
                    used.add(p2);
                }

                if (valid) break;
                attempts++;
            }

            if (attempts >= 100) {
                document.getElementById('result').innerHTML = "Couldn't find valid pairings without repeats — try Reset History.";
                return;
            }

            // Add any missed byes (shouldn't happen)
            players.forEach(p => {
                if (!used.has(p)) {
                    if ((byeHistory[p] || 0) < 1) {
                        pairings.push(`${p} has a bye`);
                        byeHistory[p] = (byeHistory[p] || 0) + 1;
                    }
                }
            });

            const roundNum = Math.floor(history.length / Math.floor(players.length / 2)) + 1;
            document.getElementById('result').innerHTML = 
                `<strong>Round ${roundNum}</strong><br><br>` +
                pairings.join('<br>');
        }

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function resetHistory() {
            history = [];
            byeHistory = {};
            document.getElementById('result').innerHTML = "History reset — ready for a new night!";
        }
    </script>
</body>
</html>
